<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="xyz.itwill.mapper.PhonePlansMapper">

    <select id="selectPhonePlans" parameterType="map" resultType="PhonePlans">
         SELECT 
        phone_plans.plan_id, 
        phone_plans.carrier_id, 
        phone_plans.product_id, 
        phone_plans.plan_product_type, 
        phone_plans.plan_type, 
        phone_plans.plan_months, 
        phone_plans.plan_option, 
        phone_plans.plan_additional,
        carriers.carrier_name,             
        products.product_name,             
        plan_details.plan_name,            
        plan_details.plan_contract_type,   
        plan_details.plan_data,            
        plan_details.additional_support,   
        plan_details.monthly_installment_fee, 
        plan_details.installment_interest, 
        plan_details.total_monthly_fee     
    FROM 
        phone_plans
    JOIN 
        carriers ON phone_plans.carrier_id = carriers.carrier_id
    JOIN 
        products ON phone_plans.product_id = products.product_id
    JOIN 
        plan_details ON phone_plans.plan_id = plan_details.plan_id
      WHERE 
        phone_plans.carrier_id = #{carrierId}
    AND 
        phone_plans.product_id = #{productId}
    AND 
        phone_plans.plan_product_type = #{planProductType}
    <if test="planType != null and planType != ''">
        AND phone_plans.plan_type = #{planType} 
    </if> 
    </select>
</mapper>
